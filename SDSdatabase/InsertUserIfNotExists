CREATE OR ALTER FUNCTION InsertUserIfNotExists( @uid UNIQUEIDENTIFIER )
    RETURNS BIT
    AS
    BEGIN
        DECLARE @UserExists BIT;
        SELECT @UserExists = COUNT() FROM Users WHERE user_id = @uid;
        IF @UserExists = 0
            INSERT INTO Users (user_id) VALUES (@uid);
            RETURN 1;
        RETURN 0;
    END
GO